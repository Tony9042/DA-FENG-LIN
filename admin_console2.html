<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å¾Œå°ç®¡ç†ï½œå¤§è±è‡¨</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--brand:#2b7a4b;--line:#e6efe8;--paper:#fff;--soft:#f3f7f4;--shadow:0 10px 24px #00000012}
*{box-sizing:border-box}
html,body{margin:0}
body{font-family:'Noto Sans TC',sans-serif;background:#eef4ef;color:#20342e}
header{background:var(--brand);color:#fff;padding:16px 20px;position:sticky;top:0;z-index:10}
main{max-width:1140px;margin:22px auto;padding:0 16px 60px}
.panel{background:var(--paper);border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);margin-bottom:18px}
.panel>h2{margin:0;padding:12px 16px;border-bottom:1px solid var(--line);font-size:18px}
.body{padding:16px}
.row{display:grid;gap:16px;grid-template-columns:1fr 1fr}
.row-2{display:grid;gap:16px;grid-template-columns:1fr 1fr}
.row-3{display:grid;gap:16px;grid-template-columns:1fr 1fr 1fr}
.row-1{display:grid;gap:12px;grid-template-columns:1fr}
@media(max-width:980px){.row,.row-2,.row-3{grid-template-columns:1fr}}
label{font-weight:800}
input[type="text"],input[type="url"],textarea{width:100%;padding:10px;border:2px solid #cfe7d6;border-radius:8px;font:inherit}
textarea{min-height:88px}
.thumb{width:100%;height:180px;border-radius:10px;object-fit:cover;background:#f3f7f3;border:1px solid #e7efe9}
input[type="file"]{display:block;margin-top:6px}
.card{border:1px dashed #cfe5d6;border-radius:10px;padding:12px}
.btn{display:inline-flex;align-items:center;gap:6px;border:0;background:var(--brand);color:#fff;padding:9px 14px;border-radius:10px;cursor:pointer;font-weight:800}
.btn.ghost{background:#fff;color:var(--brand);border:2px solid var(--brand)}
.btn.danger{background:#c14646}
.hint{font-size:12px;color:#6b7b6b;margin-top:6px}
</style>
</head>
<body>
<header><b>å¾Œå°ç®¡ç†ï½œå¤§è±è‡¨</b></header>
<main>

<!-- ç«™å°åŸºæœ¬ -->
<section class="panel">
  <h2>ç«™å°åŸºæœ¬</h2>
  <div class="body row">
    <div class="card">
      <label>ç¶²ç«™ Logo</label>
      <img id="logoPrev" class="thumb" alt="">
      <input id="logoFile" type="file" accept="image/*">
      <div class="hint">é¸æ“‡åœ–ç‰‡å¾Œæœƒä»¥ Base64 å­˜åˆ°ç€è¦½å™¨ï¼ˆlocalStorageï¼‰ã€‚</div>
    </div>
    <div class="card">
      <label>å“ç‰Œæ•…äº‹é¦–åœ–</label>
      <img id="storyPrev" class="thumb" alt="">
      <input id="storyFile" type="file" accept="image/*">
      <label style="margin-top:10px">ESG åœ–ç‰‡</label>
      <img id="esgPrev" class="thumb" alt="">
      <input id="esgFile" type="file" accept="image/*">
    </div>
  </div>
</section>

<!-- ä¸»é è¼ªæ’­ï¼ˆHEROï¼‰ -->
<section class="panel">
  <h2>ä¸»é è¼ªæ’­ï¼ˆHEROï¼‰</h2>
  <div class="body row">
    <div class="card">
      <label>ä¸»æ¨™é¡Œ</label>
      <input id="heroTitle" type="text" placeholder="ç¨®ä¸‹ä¸€å€‹ç´„å®š è®“è±æ”¶é™è‡¨">
      <label>å‰¯æ¨™é¡Œ</label>
      <textarea id="heroSub" placeholder="è½‰å»¢ç‚ºèƒ½ï¼Œé»åœŸæˆé‡‘â€¦"></textarea>
      <div class="row">
        <div>
          <label>CTA1 æ–‡æ¡ˆ</label>
          <input id="cta1Text" type="text" placeholder="äº†è§£æˆ‘å€‘çš„æ•…äº‹">
        </div>
        <div>
          <label>CTA1 é€£çµ</label>
          <input id="cta1Href" type="text" placeholder="#story">
        </div>
      </div>
      <div class="row">
        <div>
          <label>CTA2 æ–‡æ¡ˆ</label>
          <input id="cta2Text" type="text" placeholder="æ¢ç´¢ç”¢å“æœå‹™">
        </div>
        <div>
          <label>CTA2 é€£çµ</label>
          <input id="cta2Href" type="text" placeholder="#offerings">
        </div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">è¼ªæ’­åœ–ç‰‡ï¼ˆå¯ä¸Šå‚³æˆ–å¡«ç¶²å€ï¼‰</h3>
        <button id="addSlide" class="btn" type="button">ï¼‹ æ–°å¢ä¸€å¼µ</button>
      </div>
      <div id="slidesWrap" class="row-1" style="margin-top:10px"></div>
      <div class="hint">å„²å­˜å¾Œå‰å°æœƒè®€å– <code>site.hero</code>ï¼›ä¸Šå‚³åœ–ç‰‡æœƒä»¥ Base64 å­˜å…¥ localStorageï¼ˆç¸½å®¹é‡ç´„ 5MBï¼‰ã€‚</div>
    </div>
  </div>
</section>

<!-- æ¶ˆæ¯ä¸­å¿ƒï¼ˆå¯ç·¨è¼¯ï¼Œç„¡åœ–ç‰‡ï¼‰ -->
<section class="panel">
  <h2>æ¶ˆæ¯ä¸­å¿ƒ</h2>
  <div class="body">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">æ–°èåˆ—è¡¨</h3>
      <button id="addNews" class="btn" type="button">ï¼‹ æ–°å¢ä¸€å‰‡</button>
    </div>
    <div id="newsList" class="row-1" style="margin-top:10px"></div>
    <div class="hint">
      ãƒ»æ¯å‰‡åŒ…å«ã€Œæ¨™ç±¤ï¼ˆç¶ è‰²å°å¾½ç« ï¼‰ï¼æ—¥æœŸï¼æ¨™é¡Œï¼æ‘˜è¦ï¼é€£çµã€ã€‚<br>
      ãƒ»å¯ä¸Šä¸‹ç§»å‹•èª¿æ•´é †åºï¼›æŒ‰ã€Œåˆªé™¤ã€å¯ç§»é™¤è©²å‰‡ã€‚<br>
      ãƒ»å„²å­˜å¾Œå‰å°ä»¥ä¸‰æ¬„å¡ç‰‡å‘ˆç¾ï¼ˆä¸é¡¯ç¤ºåœ–ç‰‡ï¼‰ã€‚
    </div>
  </div>
</section>

<!-- å“ç‰Œæ•…äº‹ -->
<section class="panel">
  <h2>å“ç‰Œæ•…äº‹</h2>
  <div class="body row">
    <div>
      <label>å°èª</label><textarea id="storyStrap"></textarea>
      <label>æ®µè½ä¸€</label><textarea id="storyP1"></textarea>
      <label>æ®µè½äºŒ</label><textarea id="storyP2"></textarea>
    </div>
    <div>
      <label>ä¸‰é …åƒ¹å€¼ï¼ˆæ¯è¡Œä¸€é …ï¼‰</label><textarea id="storyValues" placeholder="å¾ªç’°ç¶“æ¿Ÿ&#10;åœŸå£¤å¥åº·&#10;ç¤¾æœƒé—œæ‡·"></textarea>
      <label>ä¸‰å¤§æ ¸å¿ƒï¼ˆæ¯è¡Œä¸€é …ï¼‰</label><textarea id="storyCore" placeholder="ç’°å¢ƒè²¬ä»»...&#10;å“è³ªä¿è­‰...&#10;ç¤¾æœƒé—œæ‡·..."></textarea>
    </div>
  </div>
</section>

<!-- ç”¢å“èˆ‡æœå‹™ï¼ˆå…©å¼µå¡ï¼‰ -->
<section class="panel">
  <h2>ç”¢å“èˆ‡æœå‹™ï¼ˆå…©å¼µå¡ï¼‰</h2>
  <div class="body row-2">
    <div class="card">
      <h3>ç”¢å“å¡ A</h3>
      <img id="AimgPrev" class="thumb" alt="">
      <input id="AimgFile" type="file" accept="image/*">
      <label>å¾½ç« </label><input id="Abadge" type="text" placeholder="ä¾‹å¦‚ï¼šæ ¸å¿ƒç”¢å“">
      <label>æ¨™é¡Œ</label><input id="Atitle" type="text">
      <label>å‰¯æ¨™</label><input id="Asub" type="text">
      <label>é‡é»ï¼ˆæ¯è¡Œä¸€æ¢ï¼‰</label><textarea id="Abullets"></textarea>
      <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯é¸ï¼‰</label><input id="AimgUrl" type="url" placeholder="å¡«äº†æœƒè¦†è“‹ä¸Šå‚³åœ–">
    </div>
    <div class="card">
      <h3>ç”¢å“å¡ B</h3>
      <img id="BimgPrev" class="thumb" alt="">
      <input id="BimgFile" type="file" accept="image/*">
      <label>å¾½ç« </label><input id="Bbadge" type="text" placeholder="ä¾‹å¦‚ï¼šå°ˆæ¥­æœå‹™">
      <label>æ¨™é¡Œ</label><input id="Btitle" type="text">
      <label>å‰¯æ¨™</label><input id="Bsub" type="text">
      <label>é‡é»ï¼ˆæ¯è¡Œä¸€æ¢ï¼‰</label><textarea id="Bbullets"></textarea>
      <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯é¸ï¼‰</label><input id="BimgUrl" type="url">
    </div>
  </div>
</section>

<!-- ESG æ–‡å­— -->
<section class="panel">
  <h2>ESG æ–‡å­—</h2>
  <div class="body row">
    <div><label>Environment</label><textarea id="e1"></textarea></div>
    <div><label>Social</label><textarea id="e2"></textarea></div>
  </div>
  <div class="body row-1">
    <div><label>Governance</label><textarea id="e3"></textarea></div>
  </div>
</section>

<!-- è¯çµ¡è³‡è¨Š -->
<section class="panel">
  <h2>è¯çµ¡è³‡è¨Š</h2>
  <div class="body row-3">
    <div><label>é›»è©±</label><input id="phone" type="text" placeholder="+886-7-657-7151"></div>
    <div><label>Email</label><input id="mail" type="text" placeholder="info@dafengling.com"></div>
    <div><label>åœ°å€</label><input id="addr" type="text" placeholder="å°ç£å°åŒ—å¸‚â€¦"></div>
  </div>
</section>

<!-- å€å¡ŠèƒŒæ™¯ï¼ˆæ·¡åŒ–ï¼‰ -->
<section class="panel">
  <h2>å€å¡ŠèƒŒæ™¯ï¼ˆæ·¡åŒ–ï¼‰</h2>
  <div class="body row-3">
    <div class="card">
      <h3>å“ç‰Œæ•…äº‹</h3>
      <img id="bgStoryPrev" class="thumb" alt="">
      <input id="bgStoryFile" type="file" accept="image/*">
      <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯é¸ï¼Œæœƒè¦†è“‹ä¸Šå‚³åœ–ï¼‰</label>
      <input id="bgStoryUrl" type="url" placeholder="https://...">
      <label>é€æ˜åº¦ï¼ˆ0~1ï¼‰</label>
      <input id="opStory" type="text" placeholder="0.15">
      <div class="hint">keyï¼šbg.story.url / bg.story.opacity</div>
    </div>
    <div class="card">
      <h3>ç”¢å“èˆ‡æœå‹™</h3>
      <img id="bgOfferPrev" class="thumb" alt="">
      <input id="bgOfferFile" type="file" accept="image/*">
      <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯é¸ï¼Œæœƒè¦†è“‹ä¸Šå‚³åœ–ï¼‰</label>
      <input id="bgOfferUrl" type="url" placeholder="https://...">
      <label>é€æ˜åº¦ï¼ˆ0~1ï¼‰</label>
      <input id="opOffer" type="text" placeholder="0.12">
      <div class="hint">keyï¼šbg.offerings.url / bg.offerings.opacity</div>
    </div>
    <div class="card">
      <h3>æ¶ˆæ¯ä¸­å¿ƒ</h3>
      <img id="bgNewsPrev" class="thumb" alt="">
      <input id="bgNewsFile" type="file" accept="image/*">
      <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯é¸ï¼Œæœƒè¦†è“‹ä¸Šå‚³åœ–ï¼‰</label>
      <input id="bgNewsUrl" type="url" placeholder="https://...">
      <label>é€æ˜åº¦ï¼ˆ0~1ï¼‰</label>
      <input id="opNews" type="text" placeholder="0.12">
      <div class="hint">keyï¼šbg.news.url / bg.news.opacity</div>
    </div>
  </div>

  <div class="body row-3">
    <div class="card">
      <h3>ç¤¾ç¾¤æ°¸çºŒ</h3>
      <img id="bgEsgPrev" class="thumb" alt="">
      <input id="bgEsgFile" type="file" accept="image/*">
      <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯é¸ï¼Œæœƒè¦†è“‹ä¸Šå‚³åœ–ï¼‰</label>
      <input id="bgEsgUrl" type="url" placeholder="https://...">
      <label>é€æ˜åº¦ï¼ˆ0~1ï¼‰</label>
      <input id="opEsg" type="text" placeholder="0.12">
      <div class="hint">keyï¼šbg.esg.url / bg.esg.opacity</div>
    </div>
    <div class="card">
      <h3>è¯çµ¡æˆ‘å€‘</h3>
      <img id="bgContactPrev" class="thumb" alt="">
      <input id="bgContactFile" type="file" accept="image/*">
      <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯é¸ï¼Œæœƒè¦†è“‹ä¸Šå‚³åœ–ï¼‰</label>
      <input id="bgContactUrl" type="url" placeholder="https://...">
      <label>é€æ˜åº¦ï¼ˆ0~1ï¼‰</label>
      <input id="opContact" type="text" placeholder="0.25">
      <div class="hint">keyï¼šbg.contact.url / bg.contact.opacity</div>
    </div>
  </div>
</section>

<!-- å„²å­˜ -->
<section class="panel">
  <h2>å„²å­˜</h2>
  <div class="body">
    <button id="save" class="btn">ğŸ’¾ å„²å­˜åˆ°ç€è¦½å™¨</button>
    <button id="export" class="btn ghost">â¬‡ åŒ¯å‡º JSON</button>
    <label class="btn ghost" style="cursor:pointer">â¬† åŒ¯å…¥ JSON<input id="import" type="file" accept="application/json" style="display:none"></label>
    <button id="clear" class="btn danger">ğŸ—‘ æ¸…é™¤æ‰€æœ‰è‡ªè¨‚</button>
    <div class="hint">æç¤ºï¼šè³‡æ–™å­˜æ–¼æ­¤è£ç½®çš„ localStorageã€‚è«‹ç¢ºä¿ã€Œå‰å°èˆ‡å¾Œå°ä½¿ç”¨åŒä¸€å€‹ä¾†æºï¼ˆoriginï¼‰ã€ã€‚</div>
  </div>
</section>

</main>

<script>
/* ===== å„²å­˜å¥åº·æª¢æŸ¥ï¼ˆå»ºè­°ä¿ç•™ï¼‰ ===== */
(function storageHealthCheck(){
  function lsOK(){ try{ const k='__ls_test__'+Date.now(); localStorage.setItem(k,'1'); localStorage.removeItem(k); return true; }catch(e){ return false; } }
  function usedMB(){ try{ const bytes = Object.values(localStorage).reduce((n,s)=> n + (s ? s.length : 0), 0); return (bytes/1024/1024).toFixed(2);}catch{ return 'N/A'; } }
  const banner = document.createElement('div');
  banner.style.cssText = 'background:#eefaf2;border:1px solid #c8efd8;color:#0f5132;padding:10px 12px;border-radius:10px;margin:12px 16px';
  banner.innerHTML = `<b>âœ… localStorage å¯ç”¨</b>ã€€ç›®å‰ä¼°è¨ˆä½¿ç”¨é‡ï¼šç´„ ${usedMB()} MB`;
  if (location.protocol === 'file:' || !lsOK()){
    banner.style.background='#fff7e6'; banner.style.borderColor='#ffd9a8'; banner.style.color='#5b3b00';
    banner.innerHTML = `<b>âš  å»ºè­°ä»¥ http/https ä¼ºæœå™¨é–‹å•Ÿ</b><br>file:// æ¨¡å¼ä¸‹ï¼Œå‰å¾Œå°å¯èƒ½ä¸åŒä¾†æºï¼Œè³‡æ–™ä¸å…±äº«ã€‚`;
  }
  document.body.prepend(banner);
})();
</script>

<script>
/* ===== åŸºæœ¬å·¥å…·èˆ‡é è¨­ ===== */
const defaults = {
  logo:"https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=200&auto=format&fit=crop",
  storyImg:"https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=1600&auto=format&fit=crop",
  esgImg:"https://images.unsplash.com/photo-1558985040-ed4d5029db49?q=80&w=1600&auto=format&fit=crop",

  hero:{
    title:"ç¨®ä¸‹ä¸€å€‹ç´„å®š è®“è±æ”¶é™è‡¨",
    sub:"è½‰å»¢ç‚ºèƒ½ï¼Œé»åœŸæˆé‡‘ã€‚èˆ‡åœŸåœ°å…±å‰µæ°¸çºŒå¾ªç’°çš„ç¾å¥½æœªä¾†ã€‚",
    cta1:{text:"äº†è§£æˆ‘å€‘çš„æ•…äº‹",href:"#story"},
    cta2:{text:"æ¢ç´¢ç”¢å“æœå‹™",href:"#offerings"},
    slides:[
      "https://images.pexels.com/photos/707915/pexels-photo-707915.jpeg",
      "https://images.pexels.com/photos/1438994/pexels-photo-1438994.jpeg",
      "https://images.pexels.com/photos/721991/pexels-photo-721991.jpeg"
    ]
  },

  story:{
    strap:"åœ¨ç¹è¯çš„éƒ½å¸‚è§’è½èˆ‡å»£è¢¤çš„ç”°é‡ä¹‹é–“ï¼Œæˆ‘å€‘è¨˜å¾—èˆ‡åœŸåœ°æœ€åˆçš„ç´„å®š",
    p1:"æˆ‘å€‘çš„æ•…äº‹ï¼Œå§‹æ–¼å‰µè¾¦äººå°åœŸåœ°æ·±åˆ‡çš„ç–¼æƒœèˆ‡æ‰¿è«¾â€¦â€¦",
    p2:"æ¸›ç¢³èˆ‡è±æ”¶ä¸å¿…äºŒé¸ä¸€ã€‚é€éå¾ªç’°è¾²æ¥­èˆ‡ç§‘å­¸å †è‚¥ï¼Œè®“åœŸå£¤æ›´å¥åº·ã€ç¤¾æœƒæ›´æ°¸çºŒã€‚",
    values:["å»¢æ£„ç‰©è®Šæˆæœ‰åƒ¹å€¼è³‡æº","ç§‘æŠ€èˆ‡è‡ªç„¶çš„å®Œç¾çµåˆ","å‰µé€ åœ¨åœ°å…±å¥½èˆ‡å°±æ¥­"],
    core:["å°‡ç¢³ç©©å®šå°å­˜æ–¼åœŸå£¤ä¸­ï¼Œé‚å‘ç¢³ä¸­å’Œ","æä¾›ä½œç‰©ç©©å®šã€é•·æ•ˆçš„ç‡Ÿé¤Šä¾†æº","èˆ‡ç¤¾å€ã€è¾²å‹åˆä½œï¼Œå»ºç«‹å…±äº«ç”Ÿæ…‹åœˆ"]
  },

  offerings:{ cards:[
    {badge:"æ ¸å¿ƒç”¢å“",title:"ç¢³ç©©ç©©æœ‰æ©Ÿè³ªè‚¥æ–™",sub:"ç‚ºæ‚¨çš„é¤æ¡Œç©©ä½å¥åº·",img:"",bullets:["æ”¹å–„åœŸå£¤å¥åº·ï¼Œæä¾›é•·æ•ˆç‡Ÿé¤Š","é©ç”¨æ–¼è¾²ç”°èˆ‡å®¶åº­åœ’è—","å›ºç¢³æ¸›æ’ï¼Œæ‰“é€ æœƒå‘¼å¸çš„è¾²ç”°"]},
    {badge:"å°ˆæ¥­æœå‹™",title:"æœ‰æ©Ÿå»¢æ£„ç‰©å›æ”¶æœå‹™",sub:"èˆ‰æ‰‹ä¹‹å‹ï¼Œæ°¸çºŒä¹‹é‘°",img:"",bullets:["ç¤¾å€åˆä½œï¼Œå»ºç«‹å…±å¥½ç”Ÿæ…‹åœˆ","å®Œæ•´å›æ”¶è™•ç†æµç¨‹","ä¿ƒé€²å¾ªç’°ç¶“æ¿Ÿï¼Œè³‡æºæ°¸çºŒåˆ©ç”¨"]}
  ]},

  esgText:[
    "æˆ‘å€‘è‡´åŠ›æ–¼å°‡æœ‰æ©Ÿå»¢æ£„ç‰©è½‰åŒ–ç‚ºè³‡æºï¼Œæ¸›å°‘æ©åŸ‹èˆ‡ç„šç‡’ï¼Œé€éç¢³ç©©ç©©å°å­˜æ–¼åœŸå£¤ã€‚",
    "èˆ‡ç¤¾å€ã€è¾²å ´åˆä½œï¼Œå»ºå›æ”¶ç¶²çµ¡èˆ‡æ•™è‚²æ¨å»£ã€‚",
    "é€æ˜æ²»ç†ã€èª ä¿¡ç¶“ç‡Ÿï¼Œå»ºç«‹é•·æœŸä¿¡ä»»ã€‚"
  ],

  contact:{phone:"+886-7-657-7151",mail:"info@dafengling.com",addr:"å°ç£å°åŒ—å¸‚ä¿¡ç¾©å€æ°¸çºŒå¤§é“123è™Ÿ"},

  bg:{
    story:{url:"https://images.unsplash.com/photo-1615716200048-1b1d0e012297?q=80&w=1600&auto=format&fit=crop", opacity:.15},
    offerings:{url:"https://images.unsplash.com/photo-1523861751938-30554961e309?q=80&w=1600&auto=format&fit=crop", opacity:.12},
    news:{url:"https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d?q=80&w=1600&auto=format&fit=crop", opacity:.12},
    esg:{url:"https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=1600&auto=format&fit=crop", opacity:.12},
    contact:{url:"https://images.unsplash.com/photo-1543339308-43f61b6d13a2?q=80&w=1600&auto=format&fit=crop", opacity:.25}
  },

  /* æ¶ˆæ¯ä¸­å¿ƒé è¨­ï¼ˆç„¡åœ–ç‰‡ï¼‰ */
  news:[
    {badge:"å…¬å¸æ–°è", date:"2024å¹´3æœˆ15æ—¥", title:"å¤§è±è‡¨èˆ‡åœ¨åœ°è¾²å ´ç°½ç½²åˆä½œå‚™å¿˜éŒ„", excerpt:"æ”œæ‰‹æ¨å‹•æœ‰æ©Ÿè¾²æ¥­ç™¼å±•ï¼Œå»ºç«‹å‹å–„å¾ªç’°ç”Ÿæ…‹ç³»çµ±ã€‚", link:"#"},
    {badge:"æˆæœåˆ†äº«", date:"2024å¹´3æœˆ10æ—¥", title:"ç¢³ç©©ç©©è‚¥æ–™åŠ©åŠ›è¾²å‹å¢ç”¢30%", excerpt:"ç¶“éä¸€å­£çš„ä½¿ç”¨ï¼Œåˆä½œè¾²å‹åæ˜ ä½œç‰©å“è³ªç©©å®šæå‡ã€‚", link:"#"},
    {badge:"æ´»å‹•è³‡è¨Š", date:"2024å¹´3æœˆ20æ—¥", title:"æ°¸çºŒè¾²æ¥­å¯¦è¨ªç¯€ç›®å°‡æ’­å‡º", excerpt:"é‚€è«‹ç”¢å­¸ç•Œå°ˆå®¶å…±åŒæ¢è¨è³‡æºå¾ªç’°çš„æœªä¾†ç™¼å±•ã€‚", link:"#"}
  ]
};

const $=s=>document.querySelector(s);
const read64=f=>new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(f);});
function load(key,fallback){try{const raw=localStorage.getItem(key);return raw?JSON.parse(raw):structuredClone(fallback);}catch{return structuredClone(fallback)}}
function safeSetItem(k, v) { try { localStorage.setItem(k, v); return true; } catch(e){ console.error('localStorage error on', k, e); return false; } }

/* Slides è¡Œé …ç›® */
function createSlideRow(data={}){ 
  const wrap=document.createElement('div'); 
  wrap.className='card';
  wrap.style.display='grid'; wrap.style.gridTemplateColumns='140px 1fr'; wrap.style.gap='12px'; wrap.style.alignItems='center';
  wrap.innerHTML=`
    <div>
      <div class="row" style="grid-template-columns:1fr 200px;gap:8px">
        <input type="url" class="slide-url" placeholder="åœ–ç‰‡ç¶²å€ï¼ˆè‹¥ç•™ç©ºå°±ç”¨ä¸‹æ–¹ä¸Šå‚³æª”ï¼‰">
        <input type="file" class="slide-file" accept="image/*">
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button type="button" class="btn ghost btn-up">â†‘ ä¸Šç§»</button>
        <button type="button" class="btn ghost btn-down">â†“ ä¸‹ç§»</button>
        <button type="button" class="btn danger btn-del">åˆªé™¤</button>
      </div>
    </div>`;
  const urlInput=wrap.querySelector('.slide-url'); const fileInput=wrap.querySelector('.slide-file');
  if(data && data.src){ urlInput.value=data.src; }
  wrap.querySelector('.btn-up').onclick = ()=>{ const p=$('#slidesWrap'); if(wrap.previousElementSibling) p.insertBefore(wrap, wrap.previousElementSibling); };
  wrap.querySelector('.btn-down').onclick = ()=>{ const p=$('#slidesWrap'); if(wrap.nextElementSibling) p.insertBefore(wrap.nextElementSibling, wrap); };
  wrap.querySelector('.btn-del').onclick = ()=> wrap.remove();
  return wrap;
}

/* æ¶ˆæ¯ä¸­å¿ƒè¡Œé …ç›®ï¼ˆç„¡åœ–ç‰‡ï¼‰ */
function createNewsRow(data = {}) {
  const wrap = document.createElement('div');
  wrap.className = 'card';
  wrap.innerHTML = `
    <div class="row" style="grid-template-columns:180px 1fr;gap:8px">
      <div>
        <label>æ¨™ç±¤</label>
        <input type="text" class="news-badge" placeholder="ä¾‹å¦‚ï¼šå…¬å‘Šæ›´æ–°">
      </div>
      <div>
        <label>æ—¥æœŸ</label>
        <input type="text" class="news-date" placeholder="2024å¹´3æœˆ15æ—¥ / æˆ– YYYY-MM-DD">
      </div>
    </div>
    <div style="margin-top:8px">
      <label>æ¨™é¡Œ</label>
      <input type="text" class="news-title" placeholder="æ–°èæ¨™é¡Œ">
    </div>
    <div style="margin-top:8px">
      <label>æ‘˜è¦</label>
      <textarea class="news-excerpt" placeholder="ä¸€å¥ï½å…©å¥ç°¡ä»‹ï¼Œæœƒé¡¯ç¤ºåœ¨å¡ç‰‡å…§"></textarea>
    </div>
    <div style="margin-top:8px">
      <label>é€£çµ</label>
      <input type="url" class="news-link" placeholder="https://... æˆ– #">
    </div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button type="button" class="btn ghost btn-up">â†‘ ä¸Šç§»</button>
      <button type="button" class="btn ghost btn-down">â†“ ä¸‹ç§»</button>
      <button type="button" class="btn danger btn-del">åˆªé™¤</button>
    </div>
  `;

  wrap.querySelector('.news-badge').value  = data.badge  || '';
  wrap.querySelector('.news-date').value   = data.date   || '';
  wrap.querySelector('.news-title').value  = data.title  || '';
  wrap.querySelector('.news-excerpt').value= data.excerpt|| '';
  wrap.querySelector('.news-link').value   = data.link   || '';

  wrap.querySelector('.btn-up').onclick   = ()=>{ const p=$('#newsList'); if(wrap.previousElementSibling) p.insertBefore(wrap, wrap.previousElementSibling); };
  wrap.querySelector('.btn-down').onclick = ()=>{ const p=$('#newsList'); if(wrap.nextElementSibling) p.insertBefore(wrap.nextElementSibling, wrap); };
  wrap.querySelector('.btn-del').onclick  = ()=> wrap.remove();
  return wrap;
}

/* è¼‰å…¥ç•«é¢ */
function fill(){
  // åŸºæœ¬åœ–
  $('#logoPrev').src = localStorage.getItem('site.logo') || defaults.logo;
  $('#storyPrev').src = localStorage.getItem('site.storyImg') || defaults.storyImg;
  $('#esgPrev').src   = localStorage.getItem('site.esgImg')   || defaults.esgImg;

  // æ•…äº‹
  const st = load('site.story', defaults.story);
  $('#storyStrap').value = st.strap; $('#storyP1').value = st.p1; $('#storyP2').value = st.p2;
  $('#storyValues').value = (st.values||[]).join('\n');
  $('#storyCore').value   = (st.core||[]).join('\n');

  // ç”¢å“å¡ï¼ˆå…©å¼µï¼‰
  const of = load('site.offerings', defaults.offerings);
  const [A,B] = of.cards;
  const setCard = (p,card)=>{ 
    $(`#${p}imgPrev`).src = card?.img || ''; 
    $(`#${p}badge`).value = card?.badge || '';
    $(`#${p}title`).value = card?.title || '';
    $(`#${p}sub`).value   = card?.sub   || '';
    $(`#${p}bullets`).value = (card?.bullets||[]).join('\n');
    $(`#${p}imgUrl`).value = '';
  };
  setCard('A',A); setCard('B',B);

  // èƒŒæ™¯
  const bgDef = defaults.bg;
  const readBG = (k)=>({
    url: localStorage.getItem(`bg.${k}.url`) || (bgDef[k]?.url || ''),
    opacity: (()=>{ const op=parseFloat(localStorage.getItem(`bg.${k}.opacity`)); return isNaN(op) ? (bgDef[k]?.opacity ?? '') : op; })()
  });
  const s = readBG('story');     $('#bgStoryPrev').src=s.url||'';     $('#bgStoryUrl').value=s.url||'';     $('#opStory').value=s.opacity;
  const o = readBG('offerings'); $('#bgOfferPrev').src=o.url||'';     $('#bgOfferUrl').value=o.url||'';     $('#opOffer').value=o.opacity;
  const n = readBG('news');      $('#bgNewsPrev').src=n.url||'';      $('#bgNewsUrl').value=n.url||'';      $('#opNews').value=n.opacity;
  const g = readBG('esg');       $('#bgEsgPrev').src=g.url||'';       $('#bgEsgUrl').value=g.url||'';       $('#opEsg').value=g.opacity;
  const c = readBG('contact');   $('#bgContactPrev').src=c.url||'';   $('#bgContactUrl').value=c.url||'';   $('#opContact').value=c.opacity;

  // HERO
  const hero = load('site.hero', defaults.hero);
  $('#heroTitle').value = hero.title || '';
  $('#heroSub').value = hero.sub || '';
  $('#cta1Text').value = hero.cta1?.text || '';
  $('#cta1Href').value = hero.cta1?.href || '';
  $('#cta2Text').value = hero.cta2?.text || '';
  $('#cta2Href').value = hero.cta2?.href || '';

  const slidesWrap = $('#slidesWrap'); slidesWrap.innerHTML='';
  (hero.slides || []).forEach(src => slidesWrap.appendChild(createSlideRow({src})));
  $('#addSlide').onclick = ()=> slidesWrap.appendChild(createSlideRow({src:''}));

  // æ¶ˆæ¯ä¸­å¿ƒ
  const newsList = $('#newsList'); newsList.innerHTML='';
  const newsData = load('site.news', defaults.news);
  (newsData || []).forEach(n => newsList.appendChild(createNewsRow(n)));
  $('#addNews').onclick = ()=> newsList.appendChild(createNewsRow({}));
}

/* å„²å­˜ */
async function save(){
  // åŸºæœ¬åœ–
  if($('#logoFile').files[0])  localStorage.setItem('site.logo',     await read64($('#logoFile').files[0]));
  if($('#storyFile').files[0]) localStorage.setItem('site.storyImg', await read64($('#storyFile').files[0]));
  if($('#esgFile').files[0])   localStorage.setItem('site.esgImg',   await read64($('#esgFile').files[0]));

  // æ•…äº‹
  const st = load('site.story', defaults.story);
  st.strap=$('#storyStrap').value.trim();
  st.p1=$('#storyP1').value.trim();
  st.p2=$('#storyP2').value.trim();
  st.values=$('#storyValues').value.split('\n').map(s=>s.trim()).filter(Boolean).slice(0,3);
  st.core  =$('#storyCore').value.split('\n').map(s=>s.trim()).filter(Boolean).slice(0,3);
  localStorage.setItem('site.story', JSON.stringify(st));

  // ç”¢å“å¡ï¼ˆå…©å¼µï¼‰
  const of = load('site.offerings', defaults.offerings);
  of.cards = of.cards.slice(0,2);
  const writeCard = async (p,i)=>{
    if(!of.cards[i]) of.cards[i] = {};
    const card = of.cards[i];
    const f = $(`#${p}imgFile`).files[0];
    const url = $(`#${p}imgUrl`).value.trim();
    if(f) card.img = await read64(f); else if(url) card.img = url;
    card.badge=$(`#${p}badge`).value.trim();
    card.title=$(`#${p}title`).value.trim();
    card.sub=$(`#${p}sub`).value.trim();
    card.bullets=$(`#${p}bullets`).value.split('\n').map(s=>s.trim()).filter(Boolean);
  };
  await writeCard('A',0); await writeCard('B',1);
  localStorage.setItem('site.offerings', JSON.stringify(of));

  // ESG æ–‡å­—
  const et = [$('#e1').value.trim(),$('#e2').value.trim(),$('#e3').value.trim()];
  localStorage.setItem('site.esgText', JSON.stringify(et));

  // è¯çµ¡
  localStorage.setItem('site.contact', JSON.stringify({
    phone:$('#phone').value.trim(), mail:$('#mail').value.trim(), addr:$('#addr').value.trim()
  }));

  // èƒŒæ™¯
  const writeBG = async (k, fileSel, urlSel, opSel, fallbackUrl) => {
    let url = $(urlSel).value.trim();
    const f = $(fileSel).files[0];
    if(f) url = await read64(f);
    if(!url) url = fallbackUrl || '';
    const op = $(opSel).value.trim();
    if(url) localStorage.setItem(`bg.${k}.url`, url); else localStorage.removeItem(`bg.${k}.url`);
    if(op !== '' && !isNaN(parseFloat(op))) localStorage.setItem(`bg.${k}.opacity`, String(parseFloat(op)));
    else localStorage.removeItem(`bg.${k}.opacity`);
  };
  await writeBG('story',   '#bgStoryFile',   '#bgStoryUrl',   '#opStory',   defaults.bg.story.url);
  await writeBG('offerings','#bgOfferFile',  '#bgOfferUrl',   '#opOffer',   defaults.bg.offerings.url);
  await writeBG('news',    '#bgNewsFile',    '#bgNewsUrl',    '#opNews',    defaults.bg.news.url);
  await writeBG('esg',     '#bgEsgFile',     '#bgEsgUrl',     '#opEsg',     defaults.bg.esg.url);
  await writeBG('contact', '#bgContactFile', '#bgContactUrl', '#opContact', defaults.bg.contact.url);

  // æ¶ˆæ¯ä¸­å¿ƒ
  async function collectNews(){
    const rows = Array.from(document.querySelectorAll('#newsList .card'));
    const out = [];
    for (const row of rows){
      const badge  = row.querySelector('.news-badge').value.trim();
      const date   = row.querySelector('.news-date').value.trim();
      const title  = row.querySelector('.news-title').value.trim();
      const excerpt= row.querySelector('.news-excerpt').value.trim();
      const link   = row.querySelector('.news-link').value.trim();
      if (title){ out.push({badge, date, title, excerpt, link}); }
    }
    return out;
  }
  const newsOut = await collectNews();
  localStorage.setItem('site.news', JSON.stringify(newsOut));

  // HERO
  const hero = load('site.hero', defaults.hero);
  hero.title = $('#heroTitle').value.trim();
  hero.sub   = $('#heroSub').value.trim();
  hero.cta1  = { text: $('#cta1Text').value.trim(), href: $('#cta1Href').value.trim() };
  hero.cta2  = { text: $('#cta2Text').value.trim(), href: $('#cta2Href').value.trim() };

  async function collectSlides(){
    const rows = Array.from(document.querySelectorAll('#slidesWrap .card'));
    const out = [];
    for (const row of rows){
      const url = row.querySelector('.slide-url').value.trim();
      const f = row.querySelector('.slide-file').files[0];
      if (f) out.push(await read64(f));
      else if (url) out.push(url);
    }
    return out;
  }
  hero.slides = await collectSlides();

  const ok = safeSetItem('site.hero', JSON.stringify(hero));
  if(!ok){
    const used = Object.values(localStorage).reduce((n, s)=> n + (s?.length||0), 0);
    alert('â—å„²å­˜å¤±æ•—ï¼šlocalStorage å®¹é‡å¯èƒ½ä¸è¶³ã€‚\n'
      +'å»ºè­°ï¼š\n1) å„ªå…ˆç”¨ã€Œåœ–ç‰‡ç¶²å€ã€å–ä»£ä¸Šå‚³ï¼ˆBase64 å¾ˆå¤§ï¼‰\n'
      +'2) å£“ç¸®åœ–ç‰‡ï¼šå¯¬~1600pxã€JPG å“è³ª 70\n'
      +`ç›®å‰ä¼°è¨ˆä½¿ç”¨é‡ï¼šç´„ ${(used/1024/1024).toFixed(2)} MB`);
    return;
  }

  alert('âœ… å·²å„²å­˜ï¼å›åˆ°å‰å°é‡æ–°æ•´ç†å³å¯çœ‹åˆ°æ›´æ–°ã€‚');
}

/* åŒ¯å‡º / åŒ¯å…¥ / æ¸…é™¤ */
function exportAll(){
  const dump = {
    'site.logo': localStorage.getItem('site.logo') || defaults.logo,
    'site.storyImg': localStorage.getItem('site.storyImg') || defaults.storyImg,
    'site.esgImg': localStorage.getItem('site.esgImg') || defaults.esgImg,
    'site.story': load('site.story', defaults.story),
    'site.offerings': load('site.offerings', defaults.offerings),
    'site.esgText': load('site.esgText', defaults.esgText),
    'site.contact': load('site.contact', defaults.contact),
    'site.hero': load('site.hero', defaults.hero),
    'site.news': load('site.news', defaults.news),

    'bg.story.url': localStorage.getItem('bg.story.url') || (defaults.bg.story.url || ''),
    'bg.story.opacity': localStorage.getItem('bg.story.opacity') || String(defaults.bg.story.opacity ?? ''),
    'bg.offerings.url': localStorage.getItem('bg.offerings.url') || (defaults.bg.offerings.url || ''),
    'bg.offerings.opacity': localStorage.getItem('bg.offerings.opacity') || String(defaults.bg.offerings.opacity ?? ''),
    'bg.news.url': localStorage.getItem('bg.news.url') || (defaults.bg.news.url || ''),
    'bg.news.opacity': localStorage.getItem('bg.news.opacity') || String(defaults.bg.news.opacity ?? ''),
    'bg.esg.url': localStorage.getItem('bg.esg.url') || (defaults.bg.esg.url || ''),
    'bg.esg.opacity': localStorage.getItem('bg.esg.opacity') || String(defaults.bg.esg.opacity ?? ''),
    'bg.contact.url': localStorage.getItem('bg.contact.url') || (defaults.bg.contact.url || ''),
    'bg.contact.opacity': localStorage.getItem('bg.contact.opacity') || String(defaults.bg.contact.opacity ?? ''),
  };
  const blob = new Blob([JSON.stringify(dump,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='dafengling-site-data.json'; a.click();
}

function importAll(file){
  const r=new FileReader();
  r.onload=()=>{ try{
    const data=JSON.parse(r.result);
    Object.entries(data).forEach(([k,v])=>{
      if(typeof v==='string' && (k==='site.logo' || k==='site.storyImg' || k==='site.esgImg')) localStorage.setItem(k,v);
      else localStorage.setItem(k,JSON.stringify(v));
    });
    fill(); alert('âœ… åŒ¯å…¥å®Œæˆ');
  }catch(e){ alert('åŒ¯å…¥å¤±æ•—ï¼šJSON æ ¼å¼ä¸æ­£ç¢º'); } };
  r.readAsText(file);
}

function clearAll(){
  if(!confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è‡ªè¨‚ï¼Ÿ')) return;
  [
    'site.logo','site.storyImg','site.esgImg',
    'site.story','site.offerings','site.esgText','site.contact','site.hero','site.news',
    'bg.story.url','bg.story.opacity',
    'bg.offerings.url','bg.offerings.opacity',
    'bg.news.url','bg.news.opacity',
    'bg.esg.url','bg.esg.opacity',
    'bg.contact.url','bg.contact.opacity',
  ].forEach(k=>localStorage.removeItem(k));
  fill(); alert('å·²æ¸…é™¤');
}

/* äº‹ä»¶æ›è¼‰ */
document.addEventListener('DOMContentLoaded', ()=>{
  fill();
  document.getElementById('save').onclick = save;
  document.getElementById('export').onclick = exportAll;
  document.getElementById('import').addEventListener('change',e=>{ if(e.target.files[0]) importAll(e.target.files[0]); e.target.value=''; });
  document.getElementById('clear').onclick = clearAll;
});
</script>
</body>
</html>
